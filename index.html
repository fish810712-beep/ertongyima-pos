<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>POS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont;background:#f4f0e8}
header{padding:10px;text-align:center;font-weight:bold;background:#e6e0d8}
.main{display:flex;height:calc(100vh - 50px)}
.left{flex:3;padding:12px;overflow:auto}
.right{flex:1;background:#fff;border-left:1px solid #ddd;padding:12px;display:flex;flex-direction:column}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.btn{background:#fff;border-radius:12px;padding:18px;text-align:center;font-size:22px;
box-shadow:0 2px 5px rgba(0,0,0,.15);cursor:pointer}
.btn:hover{background:#f0f0f0}
.section{margin-bottom:20px}
.section h3{margin:6px 0}
input[type=text]{width:100%;padding:10px;font-size:18px}
.cart{flex:1;overflow:auto}
.cart-item{display:flex;justify-content:space-between;border-bottom:1px dashed #ccc;padding:6px 0}
.total{text-align:right;font-size:28px;color:#b33}
.count{text-align:right;font-size:16px}
button.action{padding:14px;font-size:20px;border:none;border-radius:8px;margin-top:10px;cursor:pointer}
.clear{background:#ccc}
.pay{background:#7a9a2f;color:#fff}
.table{width:100%;border-collapse:collapse;font-size:14px}
.table th,.table td{border:1px solid #ccc;padding:4px;text-align:center}
</style>
</head>

<body>
<header>POS</header>
<div class="main">
<div class="left">

<div class="section">
<h3>金額快捷</h3>
<div class="grid" id="priceBtns"></div>
</div>

<div class="section">
<h3>條碼輸入</h3>
<input id="barcodeInput" placeholder="掃描條碼後 Enter">
</div>

<div class="section">
<h3>Excel 匯入（xlsx）</h3>
<input type="file" id="excelInput" accept=".xlsx">
</div>

<div class="section">
<h3>庫存</h3>
<table class="table">
<thead><tr><th>條碼</th><th>品名</th><th>價格</th><th>庫存</th></tr></thead>
<tbody id="stockTable"></tbody>
</table>
</div>

</div>

<div class="right">
<div class="cart" id="cart"></div>
<div class="count" id="count">件數：0</div>
<div class="total" id="total">$0</div>
<button class="action clear" onclick="clearCart()">清空</button>
<button class="action pay" onclick="checkout()">結帳完成</button>
</div>
</div>

<script>
const prices=[100,150,190,200,250,290,300,350,390,400,450,490,500,550,590,600,650,690,700,790,800,890];
let inventory=JSON.parse(localStorage.getItem('inventory')||'{}');
let cart=JSON.parse(localStorage.getItem('cart')||'[]');

const priceBtns=document.getElementById('priceBtns');
prices.forEach(p=>{
const d=document.createElement('div');
d.className='btn';
d.innerText='$'+p;
d.onclick=()=>addItem({name:'金額',price:p});
priceBtns.appendChild(d);
});

function save(){localStorage.setItem('inventory',JSON.stringify(inventory));
localStorage.setItem('cart',JSON.stringify(cart));}

function render(){
const c=document.getElementById('cart');c.innerHTML='';
let total=0;
cart.forEach((i,idx)=>{
total+=i.price;
const d=document.createElement('div');
d.className='cart-item';
d.innerHTML=`${i.name} $${i.price} <span style="cursor:pointer;color:red" onclick="remove(${idx})">✕</span>`;
c.appendChild(d);
});
document.getElementById('total').innerText='$'+total;
document.getElementById('count').innerText='件數：'+cart.length;
renderStock();
save();
}

function addItem(item){cart.push(item);render();}

function remove(i){
const it=cart[i];
if(it.barcode) inventory[it.barcode].stock++;
cart.splice(i,1);render();
}

function clearCart(){
cart.forEach(i=>{if(i.barcode) inventory[i.barcode].stock++;});
cart=[];render();
}

function checkout(){
if(!cart.length)return;
cart=[];render();
alert('結帳完成');
}

function renderStock(){
const t=document.getElementById('stockTable');t.innerHTML='';
Object.values(inventory).forEach(i=>{
t.innerHTML+=`<tr><td>${i.barcode}</td><td>${i.name}</td><td>${i.price}</td><td>${i.stock}</td></tr>`;
});
}

document.getElementById('barcodeInput').addEventListener('keydown',e=>{
if(e.key==='Enter'){
const code=e.target.value.trim();
e.target.value='';
if(inventory[code]&&inventory[code].stock>0){
inventory[code].stock--;
addItem(inventory[code]);
}else alert('無此商品或庫存不足');
}
});

document.getElementById('excelInput').addEventListener('change',e=>{
const f=e.target.files[0];
const r=new FileReader();
r.onload=ev=>{
const wb=XLSX.read(ev.target.result,{type:'binary'});
const ws=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
ws.forEach(r=>{
inventory[r.barcode]={barcode:r.barcode,name:r.name,price:Number(r.price),stock:Number(r.stock)};
});
render();
};
r.readAsBinaryString(f);
});

render();
</script>
</body>
</html>
