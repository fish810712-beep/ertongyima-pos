<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<title>POS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<style>
body{margin:0;font-family:system-ui;background:#f3eee9}
header{background:#b9ada3;color:#fff;text-align:center;padding:10px;font-weight:bold}
.main{display:grid;grid-template-columns:2fr 1fr;height:calc(100vh - 48px)}

.left{padding:12px;overflow:auto}
.product{background:#fff;border-radius:12px;padding:20px;margin:10px;display:inline-block;
cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,.1)}
.product b{font-size:22px}

.right{background:#fff;border-left:1px solid #ddd;display:flex;flex-direction:column}
.cart{flex:1;padding:12px;overflow:auto}
.cart-item{display:flex;justify-content:space-between;margin-bottom:8px}
.cart-item button{border:none;background:none;color:red;font-size:18px}

.summary{padding:12px;border-top:1px solid #ddd}
.total{text-align:right;font-size:36px;color:#c0392b;font-weight:bold}
.count{text-align:right;color:#555}

input{width:100%;padding:10px;font-size:18px;margin:6px 0}
.finish{background:#7a9b3a;color:#fff;border:none;width:100%;padding:14px;
font-size:20px;border-radius:10px}
</style>
</head>

<body>
<header>POS</header>

<div class="main">
  <div class="left">
    <div class="product" onclick="addByBarcode('A001')"><b>$250</b></div>
    <div class="product" onclick="addByBarcode('A002')"><b>$100</b></div>
    <div class="product" onclick="addByBarcode('A003')"><b>$50</b></div>
  </div>

  <div class="right">
    <div class="cart" id="cart"></div>

    <div class="summary">
      <div class="count" id="count">件數：0</div>
      <div class="total" id="total">$0</div>

      <input id="cash" type="number" placeholder="實收金額" oninput="calcChange()">
      <div id="change" style="text-align:right;color:#555">找零：$0</div>

      <button class="finish" onclick="checkout()">結帳完成</button>
    </div>
  </div>
</div>

<script>
/* 商品資料（條碼 → 金額 / 庫存） */
const products = {
  A001:{price:250,stock:10},
  A002:{price:100,stock:20},
  A003:{price:50, stock:30}
};

let cart = [];
let history = JSON.parse(localStorage.getItem("history")||"[]");

/* 條碼輸入 */
let buffer="";
document.addEventListener("keydown",e=>{
  if(e.key==="Enter"){
    addByBarcode(buffer);
    buffer="";
  }else{
    buffer+=e.key;
  }
});

function addByBarcode(code){
  const p=products[code];
  if(!p||p.stock<=0)return alert("無庫存");
  cart.push(code);
  p.stock--;
  render();
}

function remove(i){
  const code=cart[i];
  products[code].stock++;
  cart.splice(i,1);
  render();
}

function render(){
  const el=document.getElementById("cart");
  let total=0;
  el.innerHTML="";
  cart.forEach((c,i)=>{
    total+=products[c].price;
    el.innerHTML+=`
      <div class="cart-item">
        <span>$${products[c].price}</span>
        <button onclick="remove(${i})">✕</button>
      </div>`;
  });
  document.getElementById("total").innerText="$"+total;
  document.getElementById("count").innerText="件數："+cart.length;
  calcChange();
}

function calcChange(){
  const cash=+document.getElementById("cash").value||0;
  const total=cart.reduce((s,c)=>s+products[c].price,0);
  document.getElementById("change").innerText="找零：$"+(cash-total);
}

function checkout(){
  if(cart.length===0)return;
  history.push({time:new Date().toLocaleString(),cart:[...cart]});
  localStorage.setItem("history",JSON.stringify(history));
  cart=[];
  document.getElementById("cash").value="";
  render();
  alert("結帳完成");
}
</script>
</body>
</html>
