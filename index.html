<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>POS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{margin:0;font-family:sans-serif;background:#f6f3ef}
header{background:#c8b6a6;color:#fff;padding:10px;text-align:center}
.main{display:flex;height:calc(100vh - 50px)}
.left{flex:2;padding:10px}
.right{flex:1;background:#fff;padding:10px;border-left:1px solid #ddd;display:flex;flex-direction:column}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.btn{padding:20px;font-size:22px;border-radius:10px;border:none;background:#fff}
.cart{flex:1;overflow:auto}
.item{display:flex;justify-content:space-between;border-bottom:1px solid #eee;padding:5px}
.total{font-size:28px;color:#c0392b;text-align:right}
.count{text-align:right}
.pay{margin-top:10px}
.pay button{width:100%;padding:15px;font-size:20px;border-radius:10px;border:none}
.del{color:red;cursor:pointer}
</style>
</head>

<body>
<header>POS</header>

<div class="main">
<div class="left">
  <input id="barcode" placeholder="掃描條碼" autofocus style="width:100%;padding:10px;font-size:18px">
  <input type="file" accept=".xlsx" onchange="importExcel(this)">
  <div class="grid" id="priceBtns"></div>
</div>

<div class="right">
  <div class="cart" id="cart"></div>
  <div class="count">件數：<span id="count">0</span></div>
  <div class="total">$<span id="total">0</span></div>
  <div class="pay">
    <button onclick="checkout()">結帳完成</button>
    <button onclick="clearCart()" style="margin-top:5px;background:#eee">清空</button>
  </div>
</div>
</div>

<script>
let products={}
let cart=[]

const prices=[10,20,30,50,100,200,300,500]

const btns=document.getElementById("priceBtns")
prices.forEach(p=>{
  let b=document.createElement("button")
  b.className="btn"
  b.innerText="$"+p
  b.onclick=()=>addItem({name:p,price:p})
  btns.appendChild(b)
})

function addItem(p){
  cart.push(p)
  render()
}

function render(){
  const c=document.getElementById("cart")
  c.innerHTML=""
  let sum=0
  cart.forEach((i,idx)=>{
    sum+=i.price
    c.innerHTML+=`<div class="item">
      <span>$${i.price}</span>
      <span class="del" onclick="remove(${idx})">✖</span>
    </div>`
  })
  document.getElementById("total").innerText=sum
  document.getElementById("count").innerText=cart.length
}

function remove(i){cart.splice(i,1);render()}
function clearCart(){cart=[];render()}

document.getElementById("barcode").addEventListener("change",e=>{
  let code=e.target.value
  if(products[code]){
    addItem(products[code])
  }
  e.target.value=""
})

function importExcel(input){
  const r=new FileReader()
  r.onload=e=>{
    const wb=XLSX.read(e.target.result,{type:"binary"})
    const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]])
    rows.forEach(r=>{
      products[r.barcode]={name:r.name,price:Number(r.price)}
    })
    alert("庫存已載入")
  }
  r.readAsBinaryString(input.files[0])
}

function checkout(){
  if(cart.length===0)return
  cart=[]
  render()
  alert("結帳完成")
}
</script>
</body>
</html>
