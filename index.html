<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>POS</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<style>
body{margin:0;font-family:sans-serif;background:#f5f0e6}
header{padding:12px;text-align:center;background:#d2c7b8;font-size:20px}
.main{display:flex;height:calc(100vh - 50px)}
.left{flex:3;padding:16px;overflow:auto}
.right{flex:1;padding:16px;border-left:1px solid #ccc;background:#fff;display:flex;flex-direction:column}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.btn{background:#fff;border-radius:12px;padding:18px;text-align:center;font-size:22px;box-shadow:0 2px 4px rgba(0,0,0,.2);cursor:pointer}
.btn:hover{background:#eee}
.section{margin-top:20px}
input{width:100%;padding:10px;font-size:18px;margin-top:6px}
.total{margin-top:auto;text-align:right}
.total .count{font-size:18px}
.total .money{font-size:32px;color:#b23}
button{padding:14px;font-size:18px;border:none;border-radius:8px;margin-top:10px;cursor:pointer}
.clear{background:#ccc}
.checkout{background:#7a9a2f;color:#fff}
.inventory{margin-top:20px;font-size:14px}
.inventory div{border-bottom:1px solid #eee;padding:4px 0}
</style>
</head>
<body>

<header>POS</header>

<div class="main">
  <div class="left">
    <div class="section">
      <strong>金額快捷</strong>
      <div class="grid" id="priceBtns"></div>
    </div>

    <div class="section">
      <strong>條碼輸入</strong>
      <input id="barcodeInput" placeholder="掃描條碼後 Enter">
    </div>

    <div class="section">
      <strong>Excel 匯入 (xlsx)</strong>
      <input type="file" id="excel">
    </div>

    <div class="section inventory">
      <strong>庫存</strong>
      <div id="inventory"></div>
    </div>
  </div>

  <div class="right">
    <div class="total">
      <div class="count">件數：<span id="count">0</span></div>
      <div class="money">$<span id="total">0</span></div>
    </div>
    <button class="clear" onclick="clearCart()">清空</button>
    <button class="checkout" onclick="checkout()">結帳完成</button>
  </div>
</div>

<script>
const prices=[100,150,190,200,250,290,300,350,390,400,450,490,500,550,590,600,650,690,700,790,800,890]
let cart=[]
let inventory=JSON.parse(localStorage.getItem('inventory')||'{}')
let sales=JSON.parse(localStorage.getItem('sales')||'[]')

const priceBtns=document.getElementById('priceBtns')
prices.forEach(p=>{
  const b=document.createElement('div')
  b.className='btn'
  b.innerText='$'+p
  b.onclick=()=>addItem({name:'金額',price:p})
  priceBtns.appendChild(b)
})

function addItem(item){
  cart.push(item)
  update()
}

function update(){
  document.getElementById('count').innerText=cart.length
  document.getElementById('total').innerText=cart.reduce((a,b)=>a+b.price,0)
  renderInventory()
}

function clearCart(){
  cart=[]
  update()
}

function checkout(){
  if(cart.length===0)return
  sales.push({time:new Date().toISOString(),items:cart})
  cart=[]
  localStorage.setItem('sales',JSON.stringify(sales))
  update()
  alert('結帳完成')
}

document.getElementById('barcodeInput').addEventListener('keydown',e=>{
  if(e.key==='Enter'){
    const code=e.target.value
    if(inventory[code] && inventory[code].stock>0){
      inventory[code].stock--
      addItem(inventory[code])
      saveInventory()
    }
    e.target.value=''
  }
})

document.getElementById('excel').addEventListener('change',e=>{
  const reader=new FileReader()
  reader.onload=evt=>{
    const wb=XLSX.read(evt.target.result,{type:'binary'})
    const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]])
    rows.forEach(r=>{
      inventory[r.barcode]={name:r.name,price:+r.price,stock:+r.stock}
    })
    saveInventory()
  }
  reader.readAsBinaryString(e.target.files[0])
})

function saveInventory(){
  localStorage.setItem('inventory',JSON.stringify(inventory))
  renderInventory()
}

function renderInventory(){
  const div=document.getElementById('inventory')
  div.innerHTML=''
  Object.values(inventory).forEach(i=>{
    const d=document.createElement('div')
    d.innerText=`${i.name} $${i.price} 庫存:${i.stock}`
    div.appendChild(d)
  })
}

update()
</script>
</body>
</html>
